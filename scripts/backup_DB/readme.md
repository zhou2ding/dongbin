# 备份恢复脚本使用说明

> 执行脚本时，所有的脚本都应在同一目录下
>
> 测试恢复脚本时，先卸载重装数据库再恢复（不能直接清空数据库，binlog会记录清空的操作，导致恢复失败）

- 开启定时备份方法：手动执行`schedule.sh`即可，执行时需要在脚本后跟两个参数
  - 第一个参数为备份数据的存放路径
  - 第二个参数为备份的最大保存月数

* 恢复方法：

  * `MySQL`：手动执行`mysqlrestore.sh`，需要在脚本后跟一个参数，以指定恢复的源文件(`*.sql`或`mysql-bin.*`)
  * `MongoDB`：手动执行`mongorestore.sh`，需要在脚本后跟一个参数，以指定恢复文件所在的目录（备份方案中的目录结构中的`zdb`）

* 恢复步骤：

  1. 先恢复全量

     - `MySQL`：进入`mysql_all`目录，执行恢复脚本，选择最近一次的全量备份进行恢复
     - `MongoDB`：进入`mongo_all`目录，执行恢复脚本，选择最近一次的全量备份进行恢复

  2. 再恢复增量

     再增量恢复

     - `MongoDB`：进入`mongo_inc`目录，执行恢复脚本，选择全量日期之后所有的增量备份进行恢复

       > 全量日期：备份方案中的目录结构中的`mongo_all/月份/zdb`文件夹中`success_日期`的文件名中的日期

     - `MySQL`：进入`mysql_inc`目录，进入最新日期的目录，手动执行`mongorestore.sh`，选择其中所有的`binlog`进行恢复

* 备注

  - 全量备份为每月1号执行，增量备份为每天凌晨4点执行

  - `schedule.sh`在执行完成后会自我删除，避免误操作而重复添加定时任务